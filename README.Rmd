---
output: github_document
editor_options: 
chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# DelayedMatrixStats

**DelayedMatrixStats** is a port of the 
[**matrixStats**](https://CRAN.R-project.org/package=matrixStats) API to work 
with *DelayedMatrix* objects from the 
[**DelayedArray**](http://bioconductor.org/packages/DelayedArray/) package.

For a *DelayedMatrix*, `x`, the simplest way to apply a function, `f()`, from 
**matrixStats** is`matrixStats::f(as.matrix(x))`. However, this "*realizes*" 
`x` in memory as a *base::matrix*, which typically defeats the entire purpose 
of using a *DelayedMatrix* for storing the data.

The **DelayedArray** package already implements a clever strategy called 
"block-processing" for certain common "matrix stats" operations (e.g. 
`colSums()`, `rowSums()`). This is a good start, but not all of the 
**matrixStats** API is currently supported. Furthermore, certain operations can 
be optimized with additional information about `x`. For example, if `x` is an 
*RleArray*, then `colSums(x)` can be very efficiently implemented by calling 
`sum,Rle-method()` on `x[, j]` for each `j`.

## Installation

You can install DelayedMatrixStats from github with:

```{r gh-installation, eval = FALSE}
# install.packages("devtools")
devtools::install_github("PeteHaitch/DelayedMatrixStats")
```

## Example

This is a basic example which shows you how to solve a common problem:

```{r example}
## TODO
```

## API coverage

```{r, echo = FALSE, comment="", results = "asis"}
matrixStats <- sort(grep("^(col|row)", 
                         getNamespaceExports("matrixStats"), 
                         value = TRUE))
# TODO: A better way of parsing DelayedMatrixStats NAMESPACE to get exported 
#       functions
DelayedMatrixStats <- readLines("NAMESPACE")
DelayedMatrixStats <- gsub("exportMethods|\\(|\\)", 
                           "",
                           grep("^exportMethods", 
                                DelayedMatrixStats, 
                                value = TRUE))
api <- do.call(c, lapply(matrixStats, function(fun) {
  if (fun %in% DelayedMatrixStats) {
    checkbox <- "- [x]"
  } else {
    checkbox <- "- [ ]"
  }
  paste0(checkbox, " `", fun, "()`")
}))
writeLines(api, sep = "\n")
```
